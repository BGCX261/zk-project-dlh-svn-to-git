IE6=!window.XMLHttpRequest;NIE=-[1,];cookie={set:function(f,e,d){if(typeof(e)=="string"){d=e;e=0}e=e||99;d=d||"/";var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString();for(var c in f){document.cookie=c+"="+f[c]+a+"; path="+d}},get:function(b){var f=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var g=a[d];while(g.charAt(0)==" "){g=g.substring(1,g.length)}if(g.indexOf(f)==0){return g.substring(f.length,g.length).replace(/\"/g,"")}}return null}};function xf(){var a=cookie.get("S");if(a){return a.slice(-5)}}function uuid(){var a=[],b=9,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";while(--b){a.push(c.charAt(Math.floor(Math.random()*64)))}return a.join("")}(function(b){b.fn.idTabs=function(){var e={};for(var d=0;d<arguments.length;++d){var c=arguments[d];switch(c.constructor){case Object:b.extend(e,c);break;case Boolean:e.change=c;break;case Function:e.click=c;break;case String:if(c.charAt(0)=="#"){e.start=c}else{e.event=c}break}}if(typeof e["return"]=="function"){e.change=e["return"]}return this.each(function(){b.idTabs(this,e)})};b.idTabs=function(f,e){var i=(b.metadata)?b(f).metadata():{};var g=b.extend({},b.idTabs.settings,i,e);g.now="now";var d=location.href.split("#/")[1];if(d){d="#"+d}g.start=d||g.start||0;var c=function(){var l=b(this),p=location.href;if(!l.hasClass(g.now)){var q="#"+this.href.split("#")[1];var m=[];var o=[];b("a",f).each(function(){if(this.href.match(/#/)){m.push(this);o.push("#"+this.href.split("#")[1])}});if(!((q==g.start||q==o[g.start])&&p.indexOf("#/")<0)){location.replace(p.split("#")[0]+"#/"+q.slice(1))}if(!(g.click&&false===g.click.apply(this,[q,o,f,g]))){var k=[];for(var n in o){n=o[n];if(n!=q){k.push(n)}}b(k.join(",")).hide()}for(n in m){b(m[n]).removeClass(g.now)}l.addClass(g.now)}l.blur();b(q).show();return false};var h=b("a[href*='#']",f).unbind(g.event,c).bind(g.event,c);h.each(function(){b("#"+this.href.split("#")[1]).hide()});var j=false;if((j=h.filter("."+g.now)).length){}else{if(typeof g.start=="number"&&(j=h.eq(g.start)).length){}else{if(typeof g.start=="string"&&(j=h.filter("[href*='"+g.start+"']")).length){}}}if(j){j.removeClass(g.now);j.trigger(g.event)}return g};b.idTabs.settings={change:true,click:null,event:"click"};b.__ajax=b.ajax;b.ajax=function(c){if(c.type=="POST"){var d=xf();if(d){c.data=b.extend(c.data||{},{xf:d})}}return b.__ajax(c)};b.fn.attrlist=function(d,c){c=c||" ";var e=[];this.each(function(){e.push(this[d])});return e.join(c)};b.viewsize=function(){var c=[0,0];if(typeof window.innerWidth!="undefined"){c=[window.innerWidth,window.innerHeight]}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){c=[document.documentElement.clientWidth,document.documentElement.clientHeight]}else{c=[document.body.clientWidth,document.body.clientHeight]}}return c};var a=cookie.get("B");if(!a){cookie.set({B:uuid()},999)}})(jQuery);function txt2htm(a){return $("<div/>").text(a).html()}function $id(a){return document.getElementById(a)}function js_parser(htm){var tag="script>",begin="<"+tag,end="</"+tag,pos=pos_pre=0,result=script="";while((pos=htm.indexOf(begin,pos))+1){result+=htm.substring(pos_pre,pos);pos+=8;pos_pre=htm.indexOf(end,pos);if(pos_pre<0){break}script+=htm.substring(pos,pos_pre)+";";pos_pre+=9}result+=htm.substring(pos_pre,htm.length);return{htm:result,js:function(){eval(script)}}}function center(a){return{left:(document.documentElement.offsetWidth-a.offsetWidth)/2+"px",top:(document.documentElement.clientHeight-a.offsetHeight)*0.45+"px"}}function popwin(e){if(!window.__popwin){var g=document.createElement("div");g.className="popwin_bg";document.body.appendChild(g);var d=document.createElement("div");d.className="popwin";document.body.appendChild(d);__popwin={bg:g,body:d,body_j:$(d),bg_j:$(g)}}var a=__popwin.body,c=__popwin.body_j,j=js_parser(e),f=j.htm,i=document.documentElement.clientHeight;if(popwin.X){f+='<a onclick="popwin.close()" hidefocus="true" href="javascript:;" class="popwin_close">close</a>'}a.innerHTML=f;c.css({display:"block"});if(IE6){c.css("left",center(a).left)}else{c.css(center(a))}if(a.offsetHeight+20>i){if(!IE6){c.css({top:"10px"})}a.style.height=Math.max(i-60,0)+"px";a.style.overflow="hidden"}__popwin.bg_j.css({height:a.offsetHeight+40+"px",width:a.offsetWidth+20+"px",left:a.offsetLeft-10+"px",top:a.offsetTop-10+"px",zIndex:100}).show();$(".popwin_close").css("top",a.offsetHeight);c.css({visibility:"visible",zIndex:101});j.js();if(!window.XMLHttpRequest){__popwin.bg.style.top=""}}popwin.X=1;popwin.close=function(){window.__popwin_close_callback&&__popwin_close_callback();__popwin.bg.style.display="none";__popwin.body.innerHTML="";__popwin.body.style.display="none"};popwin.loading=function(a){popwin('<p id="popwin_loading">'+txt2htm(a||"通讯中，请稍等...")+"</p>")};popwin.show_error=function(){var a=window.open("about:blank");a.document.write(popwin.xhr.responseText);a.document.close()};popwin.error=function(b,c,a){popwin.xhr=b;popwin('<div style="width:240px;text-align:center;"><p>后台发生 '+b.status+" "+c+' 错误</p><p><a href="javascript:popwin.show_error();void(0)">查看详情</a></p></div>')};popwin.load=function(b,d,a){if(typeof(d)!="object"){a=d;d=0}var c=setTimeout(function(){popwin.loading("加载中 ...")},200),e={url:b,success:function(f){clearTimeout(c);popwin(f)},cache:a||false,error:function(g,f,h){clearTimeout(c);popwin.error(g,f,h)}};if(d){e.data=d}$.ajax(e);return false};popwin.prompt=function(a,c,b){popwin.prompt.callback=c;b=b||"";popwin('<h2 class="Ph2">'+txt2htm(a)+'</h2><form class="Pmb" id="popwin_prompt_form"><p class="mt8"><input class="be" autocomplete="off" value="" type="text" style="'+popwin.prompt.style+'" id="popwin_prompt_input"></p><p align="center"><input class="f16" value="确定" style="padding:3px" type="submit"> <input class="f16" style="padding:3px" value="取消" onclick="popwin.close()" type="submit"></p></form>');with($id("popwin_prompt_input")){value=b;focus();value=b}$id("popwin_prompt_form").onsubmit=popwin.prompt.yes};popwin.prompt.style="font-size:16px;width:200px;padding:2px;";popwin.prompt.yes=function(){var a=$id("popwin_prompt_input").value;popwin.close();popwin.prompt.callback(a);return false};popwin.fit=function(b){var f=__popwin.body,c=$(f);c.css(center(f));var e=c.offset(),a=__popwin.bg_j;a.css({height:f.offsetHeight+20+"px",width:f.offsetWidth+20+"px",top:f.offsetTop-10+"px",left:f.offsetLeft-10+"px"});c.before(a);a.css("zIndex",c.css("zIndex"))};function poplogin(c){var b=location.href;POPWIN_LOGIN_HREF=c||"/"+b.slice(1+b.indexOf("/",8));popwin.load("/popwin/login.htm");return false}function title_value_tip(a){var a=$(a),c=a[0];if(!c){return}if(!c.value||c.value==""){c.value=c.title}var b=function(){if(!c.value||c.value==""||c.value==c.title){$(c).css("color","#ccc");c.value=c.title}};$(c).focus(function(){var d=c.value;a.css("color","");if(d==c.title){c.value=""}});$(c).blur(b);b()}function prize_share_msn(a){popwin('<h2 class="H1" style="margin-bottom:10px;">把下面链接通过 MSN 或 QQ 发送给好友</h2><textarea id="prize_talk" style="border:1px solid #eee;padding:3px;width:260px;height:60px"></textarea><p class="tc mt15"><a style="font-size:16px;padding:7px 10px 5px;" class="abtn" href="javascript:popwin.close();void(0);">确定</a></p>');$("#prize_talk").val(a).select()}function share_a(k,d){var j=encodeURIComponent,g=["www.douban.com/recommend/?url=$u&title=$t","豆瓣","v.t.sina.com.cn/share/share.php?title=$u $t","新浪","share.renren.com/share/buttonshare.do?link=$u&title=$t","人人","www.kaixin001.com/repaste/share.php?rurl=$u&rtitle=$t","开心","www.google.com/buzz/post?url=$u&message=$t","Buzz","twitter.com/home?status=$u+$t","Twitter","javascript:prize_share_msn('$u');void(0)",'QQ<span style="margin:0 3px 0 2px">/</span>MSN'],f=0,c=[],a,h;if(d){if(d.indexOf("://")<0){d="http://"+location.host+j(d)}}else{d=location.href}for(;f<g.length/2;++f){a=2*f;if(g[a].indexOf("javascript:")>0){h='href="'}else{h='target="_blank" href="http://'}c.push("<a "+h+g[a].replace("$u",d).replace("$t",j(k))+'">'+g[a+1]+"</a>")}return c.join("")}function popshare(b,a){b=b||document.title;a=a||location.pathname;popwin('<h2 class="Ph2 f16">分享到...</h2><div class="pSh">'+share_a(b,a)+"</div>")}function init_follow(){$(".fola").click(function(){var f=this.rel,a=this.href,c="淡忘",e="unfollow",d="follow",b;popwin.loading();if(a.indexOf("/"+e+"?")>0){c="关注";b=e;e=d;d=b}this.href=a.replace("/"+d+"?","/"+e+"?");this.innerHTML=c;this.blur();$.post("/j/"+d+"/"+f,function(g){if(g=="Y"){popwin.close()}else{popwin(g)}});return false});return false}function wall_rm(a){if(confirm("真的要删除它吗?")){popwin.loading();$.post("/j/wall_rm/"+a,function(){$("#wall"+a).slideUp();popwin.close()})}}function feed_reply_rm(d,c){if(confirm("真的要删除它吗?")){popwin.loading();$.post("/j/feed_reply_rm/"+d+"/"+c,function(){$("#reply"+d+"_"+c).slideUp();popwin.close()})}}function btnreply(f,c){var b=$(f),a=b.val(),e=$(c),d=f.id;if(c.text){return}if(a!=""){c.text=e.text();e.text("保存中, 请稍等 ...");$.post("/j/feed_reply/"+d.slice(3),{txt:a},function(){$(f.previousSibling).append($('<pre class="cmtp"/>').text(a));b.val("").blur();e.text(c.text);c.text=null})}}function goback(){history.length>1?history.back():location="/"}$(function(){_gaq=[["_setAccount","UA-22069234-1"],["_trackPageview"],["_trackPageLoadTime"]];var c=document.createElement("script"),a=document.getElementsByTagName("body")[0];c.setAttribute("async","true");c.src="http://www.google-analytics.com/ga.js";a.appendChild(c);if(!cookie.get("B")){cookie.set({B:uuid()},999)}});$(function(){$(".input_hide_text").blur(function(){if($(this).val()==""){$(this).val($(this).attr("title"));$(this).addClass("color-gray")}else{$(this).addClass("color-gray")}});$(".input_hide_text").focus(function(){if($(this).val()==$(this).attr("title")){$(this).val("");$(this).removeClass("color-gray")}else{if($(this).val()!==""&&$(this).val()!==$(this).attr("title")){$(this).removeClass("color-gray")}}})});$.fn.selectRange=function(b,a){return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(b,a)}else{if(this.createTextRange){var c=this.createTextRange();c.collapse(true);c.moveEnd("character",a);c.moveStart("character",b);c.select()}}})};function starmove(){var b=["糟糕","一般","还不错","挺棒的","好极了"];$(".starmove").mousemove(function(f){var a=this.offsetWidth,d=f.clientX-$(this).offset().left;var c=parseInt((d+14)*5/a);this.className="star"+10*c;$(this).next().text(b[c-1]);$(this).next().next().val(c)}).css("cursor","pointer")}function digg_heart(){function a(){var d=this,b=d.rel;var c=b.split(":");var f=c[0];var g=c[1];var e=c[2];$.post("/recipe/"+f+"/",{dish_id:g},function(){d=$(d);d.toggleClass(e).blur();n_span=d.next();n_span.text(n_span.text()-0+1)})}$(".dh-gray").live("click",a);$(".dhz-gray").live("click",a)}function load_bgimg(){var b=$("#recipe-cover").css("background-image");b=b.replace("url(","").replace('"',"").replace(")","").replace('"',"");var a=$("<img />");a.hide();a.bind("load",function(){var c=$(this).height()});$("#recipe-cover").append(a);a.attr("src",b)}function nav_notifi_todo(){popwin('<div style="width:238px;padding:14px;background:#F5F5F4"><p>受海啸影响，该功能还有些恍惚...</p><p>先去 <a href="/droom/">讨论区</a> 吐个槽吧</p></div>')}function recipe_create_tip(){$(".recipe-list-popwin").click(function(){var a=$(this);var b=$("#"+a.attr("id").replace("rl","rp-pop"));popwin(b.html())})}function nav_notifi_tip(){var a=$("#noti");if(a.length){popwin(a.html());__popwin_close_callback=function(){var b=$("#has-noti");if(b.length){$.post("/",{del_noti:1},function(){$(".nav-noti-n").hide()})}window.__popwin_close_callback=null}}}$(function(){if(cookie.get("profile")=="1"){$("#maincontent").append($("pre:last"))}});$(function(){var a=$("#header .setting");$("#header li.last a").mouseover(function(){a.css("visibility","visible")});$(document).click(function(){a.css("visibility","hidden")});a.click(function(b){if(b.target.nodeName!="A"){b.stopPropagation()}})});